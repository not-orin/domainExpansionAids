<script>
	

// nodes = {0:{"position":[0,0], "connections":[]}}

nodes = {'0': {'position': [1459, 2005], 'connections': ['1'], 'labels': ['Main Entrance']}, '1': {'position': [1459, 1969], 'connections': ['0', '2', '7'], 'labels': []}, '2': {'position': [1393, 1969], 'connections': ['1', '3', '4'], 'labels': []}, '3': {'position': [1394, 2007], 'connections': ['2'], 'labels': ['Main Entrance']}, '4': {'position': [1392, 1923], 'connections': ['2', '5'], 'labels': []}, '5': {'position': [1392, 1872], 'connections': ['4', '6'], 'labels': []}, '6': {'position': [1456, 1871], 'connections': ['5', '7', '8'], 'labels': []}, '7': {'position': [1458, 1924], 'connections': ['6', '1'], 'labels': []}, '8': {'position': [1534, 1871], 'connections': ['6', '9', '10'], 'labels': []}, '9': {'position': [1535, 1907], 'connections': ['8'], 'labels': ['G6']}, '10': {'position': [1616, 1872], 'connections': ['8', '11', '12', '59'], 'labels': []}, '11': {'position': [1616, 1907], 'connections': ['10'], 'labels': ['G7']}, '12': {'position': [1679, 1872], 'connections': ['10', '13', '14'], 'labels': []}, '13': {'position': [1679, 1906], 'connections': ['12'], 'labels': ['G8']}, '14': {'position': [1752, 1873], 'connections': ['12', '15', '17'], 'labels': []}, '15': {'position': [1753, 1908], 'connections': ['14'], 'labels': ['G11']}, '17': {'position': [1906, 1873], 'connections': ['14', '18', '19'], 'labels': []}, '18': {'position': [1907, 1903], 'connections': ['17'], 'labels': ['G12']}, '19': {'position': [1954, 1874], 'connections': ['17', '20', '21'], 'labels': []}, '20': {'position': [1956, 1903], 'connections': ['19'], 'labels': ['G13']}, '21': {'position': [2153, 1874], 'connections': ['19', '22', '25', '26'], 'labels': []}, '22': {'position': [2154, 1909], 'connections': ['21', '23', '24'], 'labels': []}, '23': {'position': [2105, 1910], 'connections': ['22'], 'labels': ['G14']}, '24': {'position': [2198, 1912], 'connections': ['22'], 'labels': ['G16']}, '25': {'position': [2192, 1873], 'connections': ['21'], 'labels': ['G6']}, '26': {'position': [2152, 1740], 'connections': ['21', '27', '33'], 'labels': []}, '27': {'position': [2108, 1738], 'connections': ['26', '28', '29', '30'], 'labels': []}, '28': {'position': [2109, 1780], 'connections': ['27'], 'labels': []}, '29': {'position': [2108, 1697], 'connections': ['27'], 'labels': ['Toilet']}, '30': {'position': [2029, 1738], 'connections': ['27', '31'], 'labels': []}, '31': {'position': [1854, 1639], 'connections': ['30', '32'], 'labels': ['G23', 'Computer Lab']}, '32': {'position': [1677, 1530], 'connections': ['31', '58'], 'labels': []}, '33': {'position': [2152, 1720], 'connections': ['26', '34', '35'], 'labels': []}, '34': {'position': [2200, 1720], 'connections': ['33'], 'labels': ['G18']}, '35': {'position': [2153, 1687], 'connections': ['33', '36', '37'], 'labels': []}, '36': {'position': [2198, 1688], 'connections': ['35'], 'labels': ['G20']}, '37': {'position': [2155, 1651], 'connections': ['35', '38'], 'labels': []}, '38': {'position': [2153, 1600], 'connections': ['37', '39'], 'labels': []}, '39': {'position': [2153, 1551], 'connections': ['38', '40'], 'labels': []}, '40': {'position': [2154, 1439], 'connections': ['39', '41', '42'], 'labels': []}, '41': {'position': [2119, 1441], 'connections': ['40'], 'labels': ['G33a']}, '42': {'position': [2155, 1310], 'connections': ['40', '43', '44'], 'labels': ['G33', 'Research Lab']}, '43': {'position': [2155, 1192], 'connections': ['42', '62'], 'labels': []}, '44': {'position': [1821, 1306], 'connections': ['42', '45'], 'labels': []}, '45': {'position': [1800, 1306], 'connections': ['44', '46', '47'], 'labels': []}, '46': {'position': [1799, 1335], 'connections': ['45'], 'labels': ['G35']}, '47': {'position': [1740, 1305], 'connections': ['45', '48'], 'labels': ['G36']}, '48': {'position': [1716, 1305], 'connections': ['47', '49', '50'], 'labels': []}, '49': {'position': [1718, 1335], 'connections': ['48'], 'labels': ['G37']}, '50': {'position': [1626, 1302], 'connections': ['48', '51', '54', '60'], 'labels': []}, '51': {'position': [1587, 1300], 'connections': ['50', '52'], 'labels': []}, '52': {'position': [1507, 1299], 'connections': ['51', '53'], 'labels': ['G105']}, '53': {'position': [1405, 1299], 'connections': ['52', '64'], 'labels': []}, '54': {'position': [1623, 1404], 'connections': ['50', '55', '56'], 'labels': []}, '55': {'position': [1587, 1402], 'connections': ['54'], 'labels': ['Toilet', 'Women']}, '56': {'position': [1623, 1454], 'connections': ['54', '57', '58'], 'labels': []}, '57': {'position': [1582, 1454], 'connections': ['56'], 'labels': []}, '58': {'position': [1622, 1530], 'connections': ['56', '32', '59'], 'labels': []}, '59': {'position': [1623, 1838], 'connections': ['58', '10'], 'labels': []}, '60': {'position': [1625, 1171], 'connections': ['50', '61'], 'labels': []}, '61': {'position': [1863, 1170], 'connections': ['60', '62'], 'labels': ['G41', 'Collab Space']}, '62': {'position': [2130, 1169], 'connections': ['61', '43'], 'labels': []}, '64': {'position': [1405, 1340], 'connections': ['53', '65'], 'labels': []}, '65': {'position': [1434, 1340], 'connections': ['64'], 'labels': ['Toilet', 'Men']}}

function addNode(cons, pos) {
	keys = Object.keys(nodes)
	nodeNum = parseInt(keys[keys.length - 1]) + 1
	nodes[nodeNum] = {"position": pos, "connections": cons}
	for (c of cons) {
		nodes[c]["connections"].push(nodeNum)
	}
}

// addNode([0], [1, 0])        // Node 1
// addNode([1], [2, 0])        // Node 2
// addNode([1], [1, 1])        // Node 3
// addNode([2, 3], [2, 1])     // Node 4
// addNode([3], [1, 2])        // Node 5
// addNode([4, 5], [2, 2])     // Node 6
// addNode([5], [0, 2])        // Node 7
// addNode([7, 5], [0, 3])     // Node 8
// addNode([8, 6], [1, 3])     // Node 9
// addNode([9], [2, 3])        // Node 10

//		8---9---10
//		| \   \  
//		7---5---6
//		    |   |
//		    3---4
//		    |   |
//		0---1---2





function dist(start, end) {
	p1 = nodes[start]["position"]
	p2 = nodes[end]["position"]
	return ((p2[0]-p1[0])**2 + (p2[1]-p1[1])**2)**0.5
}



function aStar(start, end) {
	open = {} // {0:[cost, heuristic, parent]}
	open[start] = [0, dist(start, end), -1]
	//console.log(open)
	close = {}
	while (Object.keys(open).length >= 1) {
		lowest = Object.entries(open).sort(([ , a], [ , b]) => { // sort by total cost (low to high)
			return a[0] + a[1] - b[0] - b[1]
		})[0]

		close[lowest[0]] = lowest[1]
		delete open[lowest[0]]


		for (conn of nodes[lowest[0]]["connections"]) {
			if (!Object.keys(close).includes(conn)) {
				c = lowest[1][0] + dist(lowest[0], conn)
				if (!Object.keys(open).includes(conn)) {
					// add to open
					open[conn] = [c, dist(conn, end), lowest[0]]
				} else if (c >= open[conn][0]) {
					continue // this path is worse
				}

			}
		}
		if (lowest[0] == end) {
			console.log("reached")
			break
		}
	}
	return close

}

function trace(start, end, path) {
	jeff = [end]
	curr = end
	while (true) {
		prev = path[curr][2]
		jeff.push(parseInt(prev))
		if (prev == start) {
			break
		}
		curr = prev
	}
	return jeff.reverse()
}

function start() {

	srt = 0
	end = 42

	cl = aStar(srt, end)
	path = trace(srt, end, cl)


	dot = document.getElementById("dot")
	//dot.hidden = false

	for (i of path) {
		clone = dot.cloneNode()
		clone.hidden = false
		pos = nodes[i]["position"]
		clone.style.left = pos[0]+"px"
		clone.style.top = pos[1] + "px"
		document.body.appendChild(clone)
	}


}

</script>

<body onload="start()">
<img style="position:absolute;left: 0px;top:0px;" src="kbgf.jpg">

<div id="dot" style="position:absolute;width:10px;height:10px;background-color: blue;" hidden></div>


</body>